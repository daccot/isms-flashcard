<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISMSãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰å­¦ç¿’ã‚¢ãƒ—ãƒª</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.5.0/dist/chart.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 900px; margin: 0 auto; }
        .dashboard {
            background: white; border-radius: 15px; padding: 30px; margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); display: none;
        }
        .dashboard h2 { text-align: center; color: #667eea; margin-bottom: 25px; font-size: 1.8rem; }
        .dashboard-stats {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px; margin-bottom: 30px;
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 20px; border-radius: 10px; text-align: center;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        .stat-card h3 { font-size: 0.9rem; margin-bottom: 10px; opacity: 0.9; }
        .stat-card p { font-size: 1.8rem; font-weight: bold; }
        .progress-mini { background: rgba(255,255,255,0.2); height: 8px; border-radius: 4px; margin-top: 10px; overflow: hidden; }
        .progress-mini-bar { background: white; height: 100%; border-radius: 4px; transition: width 0.3s; width: 0%; }
        .chart-container {
            background: #f5f5f5; padding: 20px; border-radius: 10px; margin-bottom: 20px;
            position: relative; height: 300px;
        }
        .chart-container canvas { max-height: 250px; }
        .card {
            background: white; border-radius: 15px; padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); margin-bottom: 20px;
        }
        h1 { text-align: center; color: #333; margin-bottom: 20px; font-size: 1.8rem; }
        .filters { display: flex; gap: 15px; margin-bottom: 25px; flex-wrap: wrap; }
        .filter-group { flex: 1; min-width: 200px; }
        .filter-group label { display: block; margin-bottom: 5px; color: #555; font-weight: 600; }
        select {
            width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px;
            font-size: 1rem; transition: border-color 0.3s;
        }
        select:focus { outline: none; border-color: #667eea; }
        .progress { text-align: center; margin-bottom: 20px; color: #666; font-size: 1.1rem; }
        .badges { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .badge { padding: 6px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; }
        .badge-category { background: #e3f2fd; color: #1976d2; }
        .badge-difficulty { background: #fff3e0; color: #f57c00; }
        .badge-type { background: #f3e5f5; color: #7b1fa2; }
        .question {
            font-size: 1.2rem; line-height: 1.8; margin-bottom: 25px; color: #333;
            padding: 20px; background: #f8f9fa; border-radius: 10px; border-left: 4px solid #667eea;
        }
        .options { display: flex; flex-direction: column; gap: 12px; margin-bottom: 25px; }
        .option {
            display: flex; align-items: center; padding: 15px; border: 2px solid #ddd;
            border-radius: 10px; cursor: pointer; transition: all 0.3s;
        }
        .option:hover { border-color: #667eea; background: #f8f9fa; }
        .option input[type="checkbox"], .option input[type="radio"] {
            margin-right: 12px; width: 20px; height: 20px; cursor: pointer;
        }
        .option.correct { background: #d4edda; border-color: #28a745; }
        .option.incorrect { background: #f8d7da; border-color: #dc3545; }
        .btn {
            padding: 12px 30px; border: none; border-radius: 8px; font-size: 1rem;
            font-weight: 600; cursor: pointer; transition: all 0.3s;
        }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4); }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #5a6268; }
        .actions { display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; }
        .result { text-align: center; padding: 20px; border-radius: 10px; margin-top: 20px; font-size: 1.1rem; font-weight: 600; display: none; }
        .result.correct { background: #d4edda; color: #155724; display: block; }
        .result.incorrect { background: #f8d7da; color: #721c24; display: block; }
        .final-result { text-align: center; padding: 30px; display: none; }
        .final-result h2 { color: #667eea; font-size: 2rem; margin-bottom: 20px; }
        .score { font-size: 3rem; font-weight: bold; color: #333; margin: 20px 0; }
        .extra-actions { display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; flex-wrap: wrap; }
        .btn-small { padding: 8px 16px; font-size: 0.9rem; }
        .hidden { display: none !important; }
        @media (max-width: 600px) {
            body { padding: 10px; }
            .card { padding: 20px; }
            h1 { font-size: 1.4rem; }
            .question { font-size: 1.1rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="dashboard" id="dashboard">
            <h2>ğŸ“Š å­¦ç¿’ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h2>
            <div class="dashboard-stats">
                <div class="stat-card">
                    <h3>ğŸ“… ä»Šæ—¥ã®ç›®æ¨™</h3>
                    <p id="todayGoal">5å•ä¸­ 0å•å®Œäº†</p>
                    <div class="progress-mini"><div class="progress-mini-bar" id="todayProgress"></div></div>
                </div>
                <div class="stat-card">
                    <h3>ğŸ”¥ é€£ç¶šå­¦ç¿’</h3>
                    <p id="streakDays">0æ—¥é€£ç¶š</p>
                </div>
                <div class="stat-card">
                    <h3>ğŸ¯ ç·åˆæ­£ç­”ç‡</h3>
                    <p id="overallRate">0%</p>
                </div>
            </div>
            <div class="chart-container"><canvas id="progressChart"></canvas></div>
            <div class="chart-container"><canvas id="categoryChart"></canvas></div>
            <button class="btn btn-primary" id="startQuizBtn">ğŸ“ ã‚¯ã‚¤ã‚ºã‚’é–‹å§‹</button>
        </div>
        
        <div class="card">
            <h1>ğŸ”’ ISMSãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰</h1>
            <div class="filters">
                <div class="filter-group">
                    <label for="categoryFilter">ã‚«ãƒ†ã‚´ãƒª:</label>
                    <select id="categoryFilter">
                        <option value="">ã™ã¹ã¦</option>
                        <option value="ISOåŸºç¤">ISOåŸºç¤</option>
                        <option value="ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ">ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ</option>
                        <option value="ãƒªã‚¹ã‚¯ç®¡ç†">ãƒªã‚¹ã‚¯ç®¡ç†</option>
                        <option value="ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œ">ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œ</option>
                        <option value="è³‡ç”£ç®¡ç†">è³‡ç”£ç®¡ç†</option>
                        <option value="ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡">ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡</option>
                        <option value="ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—">ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</option>
                        <option value="ç‰©ç†çš„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£">ç‰©ç†çš„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£</option>
                        <option value="ãƒãƒªã‚·ãƒ¼ç­–å®š">ãƒãƒªã‚·ãƒ¼ç­–å®š</option>
                        <option value="å¤‰æ›´ç®¡ç†">å¤‰æ›´ç®¡ç†</option>
                        <option value="æš—å·åŒ–">æš—å·åŒ–</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="difficultyFilter">é›£æ˜“åº¦:</label>
                    <select id="difficultyFilter">
                        <option value="">ã™ã¹ã¦</option>
                        <option value="åˆç´š">åˆç´š</option>
                        <option value="ä¸­ç´š">ä¸­ç´š</option>
                        <option value="ä¸Šç´š">ä¸Šç´š</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="reviewMode">ãƒ¢ãƒ¼ãƒ‰:</label>
                    <select id="reviewMode">
                        <option value="all">å…¨å•é¡Œ</option>
                        <option value="wrong">é–“é•ãˆãŸå•é¡Œã®ã¿</option>
                    </select>
                </div>
            </div>
            <div class="progress">
                <span id="questionNumber">å•é¡Œ 1/14</span> | <span id="score">æ­£è§£: 0/0</span>
            </div>
            <div id="quizContent">
                <div class="badges">
                    <span class="badge badge-category" id="categoryBadge">ã‚«ãƒ†ã‚´ãƒª</span>
                    <span class="badge badge-difficulty" id="difficultyBadge">é›£æ˜“åº¦</span>
                    <span class="badge badge-type" id="typeBadge">æŠä¸€</span>
                </div>
                <div class="question" id="questionText">èª­ã¿è¾¼ã¿ä¸­...</div>
                <div class="options" id="optionsContainer"></div>
                <div class="actions">
                    <button class="btn btn-primary" id="checkBtn">ç­”ãˆåˆã‚ã›</button>
                    <button class="btn btn-secondary hidden" id="nextBtn">æ¬¡ã®å•é¡Œ</button>
                </div>
                <div class="result" id="result"></div>
            </div>
            <div id="finalResult" class="final-result">
                <h2>ğŸ‰ ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼</h2>
                <div class="score" id="finalScore">0/0</div>
                <div class="extra-actions">
                    <button class="btn btn-small btn-primary" id="retryBtn">ã‚‚ã†ä¸€åº¦ãƒãƒ£ãƒ¬ãƒ³ã‚¸</button>
                    <button class="btn btn-small btn-secondary" id="dashboardBtn">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«æˆ»ã‚‹</button>
                    <button class="btn btn-small btn-secondary" id="exportBtn">ğŸ“Š CSVã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                    <button class="btn btn-small btn-secondary" id="shareBtn">ğ•ã§å…±æœ‰</button>
                </div>
            </div>
        </div>
    </div>
    <script id="mainScript">
// Google Sheets APIè¨­å®š
const SHEET_ID = '1fZM_E7gYopOsVc6fQ-sK9A03F78sNfOub1x0PyxM9iQ';
let allQuestions = [];
let filteredQuestions = [];
let currentQuestion = 0;
let correctCount = 0;
let selectedAnswers = {};
let quizStarted = false;

// åˆæœŸåŒ–
document.addEventListener('DOMContentLoaded', () => {
    loadQuestions();
    setupEventListeners();
});

// ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
function setupEventListeners() {
    document.getElementById('categoryFilter').addEventListener('change', applyFilters);
    document.getElementById('difficultyFilter').addEventListener('change', applyFilters);
    document.getElementById('reviewMode').addEventListener('change', applyFilters);
    document.getElementById('checkBtn').addEventListener('click', checkAnswer);
    document.getElementById('nextBtn').addEventListener('click', nextQuestion);
    document.getElementById('startQuizBtn').addEventListener('click', startQuiz);
    document.getElementById('retryBtn').addEventListener('click', retryQuiz);
    document.getElementById('dashboardBtn').addEventListener('click', showDashboard);
    document.getElementById('exportBtn').addEventListener('click', exportCSV);
    document.getElementById('shareBtn').addEventListener('click', shareOnX);
}

// Google Sheetsã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—
223
    () {
const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv`;
    
    const response = await fetch(url);
        const data = await response.text();
        const rows = data.trim().split('\n').map(line => line.split(',').map(cell => /^"|"/g(/^"|"|$/g, '')));
        const headers = rows[0];
        const allQuestions = [];
        for (let i = 1; i < rows.length; i++)
             {
                           const row = rows[i];
                           if (row.length >= 10) {
                                           allQuestions.push({id: row[0], question: row[1], options: [row[2], row[3], row[4], row[5]], correct: parseInt(row[6]), type: row[7], category: row[8], difficulty: parseInt(row[9]), wrong: false});
                                         }
                         }
    
applyFilters();
    } catch (e) {
        console.error('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', e);
        document.getElementById('questionText').textContent = 'ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚';
    }
}

// ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨
function applyFilters() {
    const category = document.getElementById('categoryFilter').value;
    const difficulty = document.getElementById('difficultyFilter').value;
    const reviewMode = document.getElementById('reviewMode').value;
    
    filteredQuestions = allQuestions.filter(q => {
        if (category && q.category !== category) return false;
        if (difficulty && q.difficulty !== difficulty) return false;
        if (reviewMode === 'wrong' && !q.wrong) return false;
        return true;
    });
    
    filteredQuestions.sort(() => Math.random() - 0.5);
}

// ã‚¯ã‚¤ã‚ºé–‹å§‹
function startQuiz() {
    if (filteredQuestions.length === 0) {
        alert('å•é¡ŒãŒã‚ã‚Šã¾ã›ã‚“ã€‚ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚');
        return;
    }
    
    quizStarted = true;
    currentQuestion = 0;
    correctCount = 0;
    selectedAnswers = {};
    
    document.getElementById('dashboard').style.display = 'none';
    document.getElementById('quizContent').style.display = 'block';
    document.getElementById('finalResult').style.display = 'none';
    
    showQuestion();
}

// å•é¡Œè¡¨ç¤º
function showQuestion() {
    if (currentQuestion >= filteredQuestions.length) {
        showFinalResult();
        return;
    }
    
    const q = filteredQuestions[currentQuestion];
    document.getElementById('questionNumber').textContent = 
        `å•é¡Œ ${currentQuestion + 1}/${filteredQuestions.length}`;
    document.getElementById('score').textContent = 
        `æ­£è§£: ${correctCount}/${currentQuestion}`;
    document.getElementById('categoryBadge').textContent = q.category;
    document.getElementById('difficultyBadge').textContent = q.difficulty;
    document.getElementById('typeBadge').textContent = q.type;
    document.getElementById('questionText').textContent = q.question;
    
    const optionsContainer = document.getElementById('optionsContainer');
    optionsContainer.innerHTML = '';
    
    const inputType = q.type === 'è¤‡æ•°é¸æŠ' ? 'checkbox' : 'radio';
    q.options.forEach((option, index) => {
        const div = document.createElement('div');
        div.className = 'option';
        div.innerHTML = `
            <input type="${inputType}" name="option" value="${index + 1}" id="opt${index}">
            <label for="opt${index}" style="margin: 0; cursor: pointer; flex: 1;">${option}</label>
        `;
        optionsContainer.appendChild(div);
    });
    
    document.getElementById('checkBtn').classList.remove('hidden');
    document.getElementById('nextBtn').classList.add('hidden');
    document.getElementById('result').classList.remove('correct', 'incorrect');
    document.getElementById('result').style.display = 'none';
}

// ç­”ãˆåˆã‚ã›
function checkAnswer() {
    const q = filteredQuestions[currentQuestion];
    const inputs = document.querySelectorAll('input[name="option"]');
    const selected = Array.from(inputs).filter(i => i.checked).map(i => i.value);
    
    if (selected.length === 0) {
        alert('é¸æŠè‚¢ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚');
        return;
    }
    
    const correctAnswers = q.type === 'è¤‡æ•°é¸æŠ' 
        ? q.correct.split(',').map(s => s.trim())
        : [q.correct];
    
    const isCorrect = selected.length === correctAnswers.length &&
        selected.every(s => correctAnswers.includes(s));
    
    selectedAnswers[q.id] = { selected, correct: correctAnswers, isCorrect };
    
    if (isCorrect) {
        correctCount++;
        q.wrong = false;
        showResultMessage('âœ… æ­£è§£ã§ã™ï¼', true);
    } else {
        q.wrong = true;
        showResultMessage(
            `âŒ ä¸æ­£è§£ã§ã™ã€‚æ­£è§£: ${correctAnswers.join(', ')}`,
            false
        );
    }
    
    document.getElementById('checkBtn').classList.add('hidden');
    document.getElementById('nextBtn').classList.remove('hidden');
    updateHistory();
}

// çµæœãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
function showResultMessage(msg, isCorrect) {
    const result = document.getElementById('result');
    result.textContent = msg;
    result.className = isCorrect ? 'result correct' : 'result incorrect';
    result.style.display = 'block';
}

// æ¬¡ã®å•é¡Œ
function nextQuestion() {
    currentQuestion++;
    showQuestion();
}

// æœ€çµ‚çµæœè¡¨ç¤º
function showFinalResult() {
    document.getElementById('quizContent').style.display = 'none';
    document.getElementById('finalResult').style.display = 'block';
    document.getElementById('finalScore').textContent = 
        `${correctCount}/${filteredQuestions.length}`;
    updateDashboardStats();
}

// å±¥æ­´æ›´æ–°
function updateHistory() {
    let history = localStorage.getItem('isms_quiz_history');
    history = history ? JSON.parse(history) : {
        totalQuizzes: 0,
        totalQuestions: 0,
        totalCorrect: 0,
        quizHistory: [],
        wrongAnswers: []
    };
    
    const today = new Date().toISOString().split('T')[0];
    const dailyKey = `isms_daily_${today}`;
    let dailyProgress = localStorage.getItem(dailyKey);
    dailyProgress = dailyProgress ? JSON.parse(dailyProgress) : { completed: 0 };
    
    dailyProgress.completed = (dailyProgress.completed || 0) + filteredQuestions.length;
    localStorage.setItem(dailyKey, JSON.stringify(dailyProgress));
    
    history.totalQuizzes++;
    history.totalQuestions += filteredQuestions.length;
    history.totalCorrect += correctCount;
    history.quizHistory.push({
        date: new Date().toLocaleString('ja-JP'),
        percentage: Math.round((correctCount / filteredQuestions.length) * 100)
    });
    
    localStorage.setItem('isms_quiz_history', JSON.stringify(history));
}

// ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰çµ±è¨ˆæ›´æ–°
function updateDashboardStats() {
    const history = JSON.parse(localStorage.getItem('isms_quiz_history') || '{"totalQuestions":0,"totalCorrect":0,"quizHistory":[]}');
    const today = new Date().toISOString().split('T')[0];
    const dailyKey = `isms_daily_${today}`;
    const dailyProgress = JSON.parse(localStorage.getItem(dailyKey) || '{"completed":0}');
    
    const goalTarget = 5;
    const completed = Math.min(dailyProgress.completed, goalTarget);
    const todayPercent = (completed / goalTarget) * 100;
    
    document.getElementById('todayGoal').textContent = `${goalTarget}å•ä¸­ ${completed}å•å®Œäº†`;
    document.getElementById('todayProgress').style.width = todayPercent + '%';
    
    const streak = getStreak();
    document.getElementById('streakDays').textContent = `${streak}æ—¥é€£ç¶š`;
    
    const overallRate = history.totalQuestions > 0
        ? Math.round((history.totalCorrect / history.totalQuestions) * 100)
        : 0;
    document.getElementById('overallRate').textContent = overallRate + '%';
    
    renderCharts();
}

// ã‚¹ãƒˆãƒªãƒ¼ã‚¯è¨ˆç®—
function getStreak() {
    let streak = 0;
    let currentDate = new Date();
    
    while (true) {
        const dateStr = currentDate.toISOString().split('T')[0];
        const dailyKey = `isms_daily_${dateStr}`;
        const progress = localStorage.getItem(dailyKey);
        
        if (progress) {
            streak++;
            currentDate.setDate(currentDate.getDate() - 1);
        } else {
            break;
        }
    }
    
    return streak;
}

// ãƒãƒ£ãƒ¼ãƒˆæç”»
function renderCharts() {
    if (typeof Chart === 'undefined') {
        console.log('Chart.js is not loaded yet');
        return;
    }
    
    const history = JSON.parse(localStorage.getItem('isms_quiz_history') || '{"quizHistory":[]}');
    const recentHistory = history.quizHistory.slice(-10);
    
    if (document.getElementById('progressChart').chartInstance) {
        document.getElementById('progressChart').chartInstance.destroy();
    }
    
    const ctx = document.getElementById('progressChart').getContext('2d');
    document.getElementById('progressChart').chartInstance = new Chart(ctx, {
        type: 'line',
        data: {
            labels: recentHistory.map((_, i) => `${i + 1}å›ç›®`),
            datasets: [{
                label: 'æ­£ç­”ç‡ï¼ˆ%ï¼‰',
                data: recentHistory.map(h => h.percentage),
                borderColor: '#667eea',
                backgroundColor: 'rgba(102, 126, 234, 0.1)',
                borderWidth: 2,
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: { beginAtZero: true, max: 100 }
            }
        }
    });
    
    if (document.getElementById('categoryChart').chartInstance) {
        document.getElementById('categoryChart').chartInstance.destroy();
    }
    
    const categoryStats = {};
    allQuestions.forEach(q => {
        if (!categoryStats[q.category]) {
            categoryStats[q.category] = { correct: 0, total: 0 };
        }
        categoryStats[q.category].total++;
    });
    
    const ctx2 = document.getElementById('categoryChart').getContext('2d');
    document.getElementById('categoryChart').chartInstance = new Chart(ctx2, {
        type: 'bar',
        data: {
            labels: Object.keys(categoryStats),
            datasets: [{
                label: 'æ­£ç­”æ•°',
                data: Object.values(categoryStats).map(s => s.correct),
                backgroundColor: '#667eea'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });
}

// ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤º
function showDashboard() {
    document.getElementById('dashboard').style.display = 'block';
    document.getElementById('quizContent').style.display = 'block';
    document.getElementById('finalResult').style.display = 'none';
    updateDashboardStats();
}

// ã‚¯ã‚¤ã‚ºå†è©¦è¡Œ
function retryQuiz() {
    startQuiz();
}

// CSV ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
function exportCSV() {
    let csv = 'Date,Score,Percentage\n';
    const history = JSON.parse(localStorage.getItem('isms_quiz_history') || '{"quizHistory":[]}');
    history.quizHistory.forEach(h => {
        csv += `${h.date},${h.percentage}%\n`;
    });
    
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'isms_quiz_history.csv';
    link.click();
}

// Xï¼ˆTwitterï¼‰ã§å…±æœ‰
function shareOnX() {
    const history = JSON.parse(localStorage.getItem('isms_quiz_history') || '{"totalCorrect":0,"totalQuestions":0}');
    const rate = history.totalQuestions > 0
        ? Math.round((history.totalCorrect / history.totalQuestions) * 100)
        : 0;
    
    const text = `ğŸ¯ ISMSãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰å­¦ç¿’é€²æ—\næ­£è§£ç‡: ${rate}%\næ­£è§£æ•°: ${history.totalCorrect}/${history.totalQuestions}\n#ISMS #æƒ…å ±ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£`;
    const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`;
    window.open(url, '_blank');
}
    </script>
</body>
</html>


